{
  "name": "Top 3 Questions",
  "nodes": [
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -128,
        0
      ],
      "id": "dea6d234-13a7-44a4-89dd-f1053b926b27",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "LmeGnrbxQ2Mn72wG",
          "name": "Google Gemini(PaLM) Api account 2"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "Given a transcript snippet of a doctorâ€“patient conversation, generate only the top 3 follow-up questions in JSON format suitable for insertion into MongoDB. Each question should include the question text ('q'), question type ('type', e.g., open, binary, scale), relevant module ('module'), and priority ('priority', e.g., high, medium, low). Do not include any additional information or explanations",
        "hasOutputParser": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        -432,
        -272
      ],
      "id": "e6faa7c6-6820-406a-a4fe-a42628a73574",
      "name": "AI Agent",
      "alwaysOutputData": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "/transcript",
        "responseMode": "lastNode",
        "responseData": "allEntries",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -912,
        -336
      ],
      "id": "809f710a-efea-4a9a-aa9e-42f7340a0a1c",
      "name": "Webhook1",
      "webhookId": "e4d5cb9a-1c66-44ae-bc2d-faeab247859b"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.3,
      "position": [
        -896,
        -192
      ],
      "id": "03c8b408-b699-4cd5-9398-e0b4263d6568",
      "name": "When chat message received",
      "webhookId": "8f2e44d1-729b-4639-bc42-0bedd1344a45"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.infermedica.com/v3/diagnosis",
        "authentication": "predefinedCredentialType",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        64,
        240
      ],
      "id": "4baa0cdc-e741-4333-964b-d4465d95a42f",
      "name": "HTTP Request"
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"session_id\": {\n      \"type\": \"string\",\n      \"description\": \"Unique ID of the consultation session\"\n    },\n    \"language\": {\n      \"type\": \"string\",\n      \"description\": \"Language of the transcript, e.g. en, hi\"\n    },\n    \"transcript_understanding\": {\n      \"type\": \"string\",\n      \"description\": \"Short summary of what the patient said\"\n    },\n    \"detected_entities\": {\n      \"type\": \"array\",\n      \"items\": {\n        \"type\": \"object\",\n        \"properties\": {\n          \"text\": { \"type\": \"string\" },\n          \"category\": {\n            \"type\": \"string\",\n            \"enum\": [\"symptom\", \"condition\", \"lifestyle\", \"trigger\", \"other\"]\n          },\n          \"confidence\": { \"type\": \"number\" }\n        },\n        \"required\": [\"text\", \"category\", \"confidence\"]\n      }\n    },\n    \"possible_diseases\": {\n      \"type\": \"array\",\n      \"items\": {\n        \"type\": \"object\",\n        \"properties\": {\n          \"name\": { \"type\": \"string\" },\n          \"confidence\": { \"type\": \"number\" }\n        },\n        \"required\": [\"name\", \"confidence\"]\n      }\n    },\n    \"suggested_questions\": {\n      \"type\": \"array\",\n      \"items\": {\n        \"type\": \"object\",\n        \"properties\": {\n          \"q\": { \"type\": \"string\" },\n          \"type\": {\n            \"type\": \"string\",\n            \"enum\": [\"open\", \"binary\", \"scale\"]\n          },\n          \"module\": {\n            \"type\": \"string\",\n            \"enum\": [\"family_profile\", \"lifestyle\", \"medical_history\", \"recent_symptoms\", \"hospitalization\", \"female_health\", \"insurance_history\"]\n          },\n          \"priority\": {\n            \"type\": \"string\",\n            \"enum\": [\"low\", \"medium\", \"high\"]\n          }\n        },\n        \"required\": [\"q\", \"type\", \"module\", \"priority\"]\n      }\n    },\n    \"alerts\": {\n      \"type\": \"array\",\n      \"items\": {\n        \"type\": \"object\",\n        \"properties\": {\n          \"type\": {\n            \"type\": \"string\"\n          },\n          \"message\": {\n            \"type\": \"string\"\n          }\n        }\n      }\n    },\n    \"timestamp\": {\n      \"type\": \"string\",\n      \"format\": \"date-time\"\n    }\n  },\n  \"required\": [\"session_id\", \"language\", \"transcript_understanding\", \"detected_entities\", \"possible_diseases\", \"suggested_questions\", \"timestamp\"]\n}\n",
        "autoFix": true
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        256,
        16
      ],
      "id": "4199c844-4d58-4d07-a9d7-3249c0f77b7a",
      "name": "Structured Output Parser",
      "notesInFlow": false
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        480,
        128
      ],
      "id": "66e0944c-c481-4aee-9b20-f5e178c07b05",
      "name": "Google Gemini Chat Model1",
      "credentials": {
        "googlePalmApi": {
          "id": "LmeGnrbxQ2Mn72wG",
          "name": "Google Gemini(PaLM) Api account 2"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "transcript",
        "contextWindowLength": 10000
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        -656,
        16
      ],
      "id": "1bed3adf-5f41-46d0-943c-24380e590e90",
      "name": "Simple Memory"
    }
  ],
  "pinData": {},
  "connections": {
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Webhook1": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        []
      ]
    },
    "Structured Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "AI Agent",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "Structured Output Parser",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "e7b77961-65db-4897-b0b2-0dd8405d21b7",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "594f29f01da2a37aaa2f976d1465ebebcaf2699472388bb2a49773f153838bcf"
  },
  "id": "eVWv6a5uMiXbDEIz",
  "tags": []
}